{% set post_url %}{{ post.url | url | absoluteUrl(site.url) }}{% endset %}
{% set summary %}{% if post.data.description %}{{ post.data.description }}{% elif post.data.page.excerpt %}{{ post.data.page.excerpt }}{% endif %}{% endset %}
{%- set type %}{{ post.inputPath | content_type }}{% endset -%}
{
  "id": "{{ post_url }}",
  "title": "{{ post.data.title | replace('"', '\\"') | striptags | safe }} {% if prepend_title %} [{{ type | capitalize }}]{% endif %}",
  
  "summary": "{{ summary | markdownify | trim_newlines | replace('"', '\\"') | safe }}",
  
  "content_html": "{{ post.templateContent | trim_newlines | replace('"', '\\"') | safe }}",
  
  {% if type == "post" or type == "link" %}
    "url": "{{ post_url }}",
  {% else %}
    "url": "{{ post.data.url }}",
  {% endif %}
  {% if post.data.ref_url %}
    "external_url": "{{ post.data.ref_url }}",
  {% endif %}
  
  {% if post.data.tags %}
    "tags": {{ post.data.tags | dump | safe }},
  {% endif %}
  
  {% if post.data.hero %}
    "image": "{{ post.data.hero.src | absoluteUrl(site.url) }}",
  {% elif post.data.og_image %}
    "image": "{{ post.data.og_image }}",
  {% endif %}
  
  "date_published": "{{ post.date | dateToRfc3339 }}"
}